---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import { PROJECT_TAGS } from '../../data/projectTags';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="ko">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body class="bg-white">
		<Header />
		<main class="mx-auto w-full max-w-6xl px-4 py-12 sm:px-6 lg:px-8">
			<section class="space-y-10">
				<div class="flex flex-wrap items-end justify-between gap-4">
					<div>
						<h1 class="text-3xl font-semibold text-ink sm:text-4xl">Blog</h1>
						<p class="text-muted">ê¸°ìˆ ì„ ë°°ìš°ê³ , í•¨ê»˜ í˜‘ì—…í•˜ë©°, ì¡°ê¸ˆì”© ì„±ì¥í•´ê°€ëŠ” ìˆœê°„ë“¤ì„
						ê¸°ë¡í•©ë‹ˆë‹¤.
						</p>
					</div>
					<p class="text-sm text-muted">
						ì´ <span class="font-semibold text-ink">{posts.length}</span>ê°œì˜ í¬ìŠ¤íŠ¸
					</p>
				</div>
				{posts.length ? (
					<ul class="mt-8 space-y-5">
						{posts.map((post) => (
							<li class="rounded-3xl border border-muted-light bg-white/95 p-4 shadow-sm">
								<a class="flex flex-col gap-4 no-underline md:flex-row md:items-stretch" href={`/blog/${post.id}/`}>
									<div class="w-full overflow-hidden rounded-2xl bg-muted-light md:w-40 md:shrink-0">
										{post.data.heroImage ? (
											<Image class="aspect-video h-full w-full object-cover md:aspect-auto" widths={[320, 640, 960]} sizes="(max-width: 768px) 100vw, 160px" src={post.data.heroImage} alt="" />
										) : (
											<div class="flex aspect-video h-full w-full items-center justify-center text-sm text-muted md:aspect-auto">IBAS</div>
										)}
									</div>
									<div class="flex-1 space-y-3">
										<div class="flex flex-wrap items-center gap-3 text-xs font-semibold uppercase tracking-[0.25em] text-muted">
											<FormattedDate date={post.data.pubDate} />
											{post.data.tags?.slice(0, 2).map((tagId) => {
												const tag = PROJECT_TAGS.find((item) => item.id === tagId);
												return tag ? (
													<span
														class:list={[
															'rounded-full px-3 py-1 text-[0.7rem]',
															tag.colorClass ?? 'bg-accent/10 text-accent',
														]}
														aria-label={`í”„ë¡œì íŠ¸ íƒœê·¸ ${tag.label}`}
													>
														{tag.label}
													</span>
												) : null;
											})}
										</div>
										<h2 class="text-xl font-semibold text-ink sm:text-2xl">{post.data.title}</h2>
										<p class="text-base text-violet-500">by. {post.data.author?.name}</p>
										<p class="text-base text-muted">
											{post.data.description ?? 'ì´ ê¸€ì— ëŒ€í•œ ì„¤ëª…ì´ ê³§ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.'}
										</p>
									</div>
								</a>
							</li>
						))}
					</ul>
				) : (
				<div class="mt-8 rounded-3xl border border-dashed border-muted-light bg-white/60 p-12 text-center">
						<p class="text-4xl">ğŸ“</p>
						<p class="mt-3 text-lg font-semibold text-ink">ì‘ì„±ëœ ê¸€ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>
						<p class="mt-1 text-sm text-muted">ê³§ ìƒˆë¡œìš´ ê¸€ë¡œ ì°¾ì•„ëµê²Œìš”!</p>
					</div>
				)}
			</section>
		</main>
		<Footer />
	</body>
</html>
